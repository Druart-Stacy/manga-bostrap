<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mangas - Stacy Druart</title>

    <!-- Liens vers les ressources externes -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="bg-primary">
    <header>
        <nav class="navbar navbar-expand-lg bg-secondary bg-opacity-10">
            <div class="container-fluid">
                <button class="navbar-toggler text-white navbar-dark " type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon "></span>
                </button>
                <div class="collapse navbar-collapse d-lg-flex w-100" id="navbarNav">
                    <ul class="navbar-nav d-flex justify-content-between align-items-center gap-1 w-100 mb-0">
                        <li class="nav-item"><a class="nav-link text-white fs-5" href="#">Formulaire</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <h1 class="my-4 text-white">Ajouter un Livre</h1>
        <form id="addDivForm">
            <div class="mb-3">
                <label for="title" class="form-label text-white">Titre</label>
                <input class="form-control" type="text" id="title" required>
            </div>
        
            <div class="mb-3">
                <label for="description" class="form-label text-white">Description</label>
                <textarea class="form-control" id="description" rows="3"></textarea>
            </div>
            
            <div class="mb-3">
                <label for="file" class="form-label text-white">Image</label>
                <input type="file" id="file" class="form-control" accept="image/*" required>
            </div>
            <button type="submit" class="btn btn-primary rounded-pill px-3">Ajouter</button>
        </form>
        <label for="lu">Avez-vous lu le livre ?</label>
        <select id="lu">
            <option value="">non</option>
            <option value="oui">oui</option>
            <option value="encours">encours</option>
          </select>

        <div id="new-div-container" class="mt-4"></div>
    </div>

    <div class="container my-4">
        <h1 class="text-light text-center">Gestion des Tomes</h1>
        <ul id="tome-list" class="list-group"></ul>
    </div>

    <script>
        // Exemple de tomes sauvegardés dans localStorage
        const tomesExample = [
            { id: 1, name: "Tome 1", number: 1, luStatus: "non" },
            { id: 2, name: "Tome 2", number: 2, luStatus: "oui" },
            { id: 3, name: "Tome 3", number: 3, luStatus: "encours" }
        ];

        // Initialiser localStorage si vide
        if (!localStorage.getItem('tomes')) {
            localStorage.setItem('tomes', JSON.stringify(tomesExample));
        }

        // Récupérer les tomes depuis localStorage
        const tomes = JSON.parse(localStorage.getItem('tomes'));

        // Sélectionner la liste des tomes dans le DOM
        const tomeList = document.getElementById('tome-list');

        // Fonction pour afficher les tomes
        function displayTomes() {
            tomeList.innerHTML = ''; // Vider la liste

            tomes.forEach(tome => {
                // Créer un élément de liste pour chaque tome
                const listItem = document.createElement('li');
                listItem.classList.add('list-group-item', 'bg-secondary', 'text-light', 'd-flex', 'justify-content-between', 'align-items-center');

                // Contenu principal du tome
                const tomeContent = `
                    <div>
                        <strong>${tome.number} - ${tome.name}</strong>
                    </div>
                `;

                // Création du <select> pour l'état de lecture
                const select = document.createElement('select');
                select.classList.add('form-select', 'form-select-sm', 'w-25');
                select.innerHTML = `
                    <option value="non" ${tome.luStatus === 'non' ? 'selected' : ''}>non</option>
                    <option value="oui" ${tome.luStatus === 'oui' ? 'selected' : ''}>oui</option>
                    <option value="encours" ${tome.luStatus === 'encours' ? 'selected' : ''}>encours</option>
                `;

                // Écouter les changements sur le <select>
                select.addEventListener('change', (event) => {
                    tome.luStatus = event.target.value; // Mettre à jour l'état dans le tableau
                    localStorage.setItem('tomes', JSON.stringify(tomes)); // Sauvegarder dans localStorage
                    console.log(`État du tome ${tome.number} mis à jour : ${tome.luStatus}`);
                });

                // Ajouter le contenu principal et le <select> à l'élément de liste
                listItem.innerHTML = tomeContent;
                listItem.appendChild(select);

                // Ajouter l'élément à la liste
                tomeList.appendChild(listItem);
            });
        }

        // Afficher les tomes au chargement de la page
        displayTomes();
        // Charger les livres existants au démarrage
        document.addEventListener('DOMContentLoaded', function() {
            const books = JSON.parse(localStorage.getItem('books')) || [];
            books.forEach(displayBook); // Afficher chaque livre sauvegardé
        });

        document.getElementById('addDivForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Empêche la soumission du formulaire (rechargement de la page)

            // Récupérer les valeurs des champs du formulaire
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const fileInput = document.getElementById('file');

            const newBook = {
                title,
                description,
            };

            // Ajouter l'image si elle existe
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newBook.image = e.target.result; // Sauvegarde de l'image en Base64
                    saveBookToLocalStorage(newBook); // Sauvegarder dans localStorage
                    displayBook(newBook); // Afficher directement le livre
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                newBook.image = null;
                saveBookToLocalStorage(newBook); // Sauvegarder dans localStorage
                displayBook(newBook); // Afficher directement le livre
            }

            // Réinitialiser le formulaire après ajout
            document.getElementById('addDivForm').reset();
        });

        // Fonction pour sauvegarder le livre dans localStorage
        function saveBookToLocalStorage(bookData) {
            // Récupérer les livres existants depuis localStorage
            const books = JSON.parse(localStorage.getItem('books')) || [];

            // Générer un ID unique pour le livre
            bookData.id = Date.now(); // Utilisation de la date comme identifiant unique

            // Ajouter le nouveau livre au tableau
            books.push(bookData);

            // Sauvegarder le tableau mis à jour dans localStorage
            localStorage.setItem('books', JSON.stringify(books));
        }

        // Fonction pour afficher le livre directement sur la page
        function displayBook(book) {
            const container = document.getElementById('new-div-container');

            // Créer une carte pour afficher le livre
            const bookCard = document.createElement('div');
            bookCard.classList.add('card', 'mb-3');
            bookCard.style.maxWidth = '540px';

            bookCard.innerHTML = `
                <div class="row g-0">
                    ${book.image ? `<div class="col-md-4"><img src="${book.image}" class="img-fluid rounded-start" alt="${book.title}"></div>` : ''}
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">${book.title}</h5>
                            <p class="card-text">${book.description}</p>
                        </div>
                    </div>
                </div>
            `;

            container.appendChild(bookCard);
        }
         // Charger la valeur sélectionnée depuis localStorage au démarrage
         document.addEventListener('DOMContentLoaded', function () {
            const selectElement = document.getElementById('lu');
            const savedValue = localStorage.getItem('luStatus'); // Récupérer la valeur sauvegardée

            if (savedValue) {
                selectElement.value = savedValue; // Appliquer la valeur sauvegardée au champ <select>
            }

            // Écouter les changements et sauvegarder dans localStorage
            selectElement.addEventListener('change', function () {
                const selectedValue = selectElement.value; // Récupérer la valeur actuelle
                localStorage.setItem('luStatus', selectedValue); // Sauvegarder dans localStorage
                console.log(`Valeur sauvegardée : ${selectedValue}`);
            });
        });
    </script>
</body>

</html>
